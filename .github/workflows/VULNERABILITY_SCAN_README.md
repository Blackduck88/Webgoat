# Vulnerability Scanning Pipeline

This repository includes an automated vulnerability scanning pipeline that detects security issues in dependencies using OWASP Dependency Check.

## How It Works

The pipeline operates differently based on the branch:

### Feature Branches (Pull Requests)
- ✅ Scans dependencies for vulnerabilities
- 💬 **Comments on PR** with vulnerability details if medium, high, or critical vulnerabilities are found
- 📊 Uploads detailed vulnerability reports as artifacts
- ⚠️ Marks the build as failed if vulnerabilities are detected (but doesn't block merging)

### Main Branch (Merges to main)
- ✅ Scans dependencies for vulnerabilities  
- 💬 **Comments would be created** (but since it's a direct push, no PR exists)
- 🚨 **Creates GitHub Issues** for any medium, high, or critical vulnerabilities found
- 📊 Uploads detailed vulnerability reports as artifacts
- ⚠️ Marks the build as failed if vulnerabilities are detected

## Vulnerability Severity Levels

The pipeline scans for vulnerabilities with CVSS scores of 4.0 and above:

- 🔴 **Critical** (9.0-10.0): Immediate action required
- 🟠 **High** (7.0-8.9): Action required within 24-48 hours  
- 🟡 **Medium** (4.0-6.9): Action required within 1 week

## Configuration

### Threshold Settings
You can modify the CVSS threshold in the workflow file:
```yaml
env:
  CVSS_THRESHOLD: 4.0  # Current: Medium and above
```

### Suppression Rules
Vulnerabilities can be suppressed using the existing suppression file:
```
WebGoat/config/dependency-check/project-suppression.xml
```

Add entries like this to suppress specific CVEs:
```xml
<suppress>
    <notes>Explanation for suppression</notes>
    <packageUrl regex="true">^pkg:maven/group\.id/artifact\-id@.*$</packageUrl>
    <cve>CVE-YYYY-NNNNN</cve>
</suppress>
```

### Customizing Labels
When issues are created for main branch vulnerabilities, they're automatically labeled:
- `security` - All security issues
- `vulnerability-scan` - Issues from this pipeline  
- `needs-triage` - Requires team review
- `critical` - Added for critical vulnerabilities
- `high-priority` - Added for high-severity vulnerabilities

## Workflow Triggers

The pipeline runs on:
- **Pull Requests** targeting the `main` branch
- **Pushes** to the `main` branch

It ignores changes to documentation files (`.md`, `docs/`, `LICENSE`).

## Viewing Results

### Vulnerability Reports
1. Go to the GitHub Actions run
2. Download the `dependency-check-report` artifact
3. Extract and open `dependency-check-report.json`

### PR Comments
Comments on pull requests include:
- Total vulnerability count by severity
- Top 10 most critical vulnerabilities
- Dependency names and CVSS scores
- Remediation recommendations

### GitHub Issues
Issues created for main branch vulnerabilities include:
- Complete vulnerability analysis
- Action checklists for remediation
- Priority levels based on severity
- Links to the workflow run

## Manual Scanning

You can also run vulnerability scans manually:

```bash
# Scan with current configuration
mvn org.owasp:dependency-check-maven:check -Powasp

# Scan with JSON output (for detailed analysis)
mvn org.owasp:dependency-check-maven:check -Dformat=JSON -DfailBuildOnCVSS=0

# Update vulnerability database first
mvn org.owasp:dependency-check-maven:update-only
```

## Troubleshooting

### False Positives
If the scanner reports false positives:
1. Verify the vulnerability actually affects your usage
2. Add a suppression rule in `config/dependency-check/project-suppression.xml`
3. Document the reason for suppression

### High Scan Times
If scans take too long:
1. Update the vulnerability database cache
2. Consider excluding test dependencies: `-DskipTestScope=true`
3. Use the existing suppression rules to filter known safe issues

### Network Issues
If the scanner can't download vulnerability data:
1. Check firewall/proxy settings
2. Use the update-only goal first to cache data
3. Consider running scans during off-peak hours

## Security Best Practices

1. **Review all vulnerabilities** - Don't automatically suppress issues
2. **Update dependencies regularly** - Use Dependabot for automated updates
3. **Monitor security advisories** - Subscribe to security bulletins for your dependencies
4. **Test updates thoroughly** - Ensure updates don't break functionality
5. **Document decisions** - Record why specific versions are maintained

## Integration with Dependabot

This pipeline works alongside your existing Dependabot configuration:
- **Dependabot** creates PRs for dependency updates
- **This pipeline** scans those PRs for security issues
- **Combined** they provide comprehensive dependency management

## Support

For issues with the vulnerability scanning pipeline:
1. Check the GitHub Actions logs
2. Review the vulnerability report artifacts
3. Consult the OWASP Dependency Check documentation
4. Create an issue with the `vulnerability-scan` label 